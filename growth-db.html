<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Growth Dashboard | KinderCare</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Include Chart.js -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYkRSxHjVrV9QYk45EDP5K2uHOoW-0pkk",
            authDomain: "kindercare-cd7da.firebaseapp.com",
            projectId: "kindercare-cd7da",
            storageBucket: "kindercare-cd7da.firebasestorage.app",
            messagingSenderId: "930908122510",
            appId: "1:930908122510:web:40f89ca7a5cf8dc3fb48df"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let growthChart;  // Global variable to store the chart instance

        // Create the Chart based on filtered data
        function createChart(growthData) {
            const ctx = document.getElementById('growthChart').getContext('2d');

            const ages = growthData.map(data => data.age);
            const heights = growthData.map(data => data.height);
            const weights = growthData.map(data => data.weight);

            if (growthChart) {
                growthChart.destroy();
            }

            growthChart = new Chart(ctx, {
                type: 'line', 
                data: {
                    labels: ages,
                    datasets: [{
                        label: 'Height (cm)',
                        data: heights,
                        borderColor: 'blue',
                        fill: false,
                        tension: 0.1
                    }, 
                    {
                        label: 'Weight (kg)',
                        data: weights,
                        borderColor: 'green',
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Value (cm / kg)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Age (Months)'
                            }
                        }
                    }
                }
            });
        }

        // Load and populate the child dropdown list
        async function loadChildrenList() {
            const childSelect = document.getElementById('childSelect');
            const childrenSnapshot = await getDocs(collection(db, "children"));

            childrenSnapshot.forEach((childDoc) => {
                const childData = childDoc.data();
                const option = document.createElement("option");
                option.value = childDoc.id;
                option.textContent = childData.ChildName;
                childSelect.appendChild(option);
            });
        }

        // Filter growth data based on selected child
        async function filterGrowthData() {
            const childId = document.getElementById('childSelect').value;

            if (childId) {
                const growthSnapshot = await getDocs(query(collection(db, "growth"), where("childId", "==", childId)));
                const growthData = [];

                growthSnapshot.forEach((docSnap) => {
                    const growth = docSnap.data();
                    growthData.push(growth);
                });

                createChart(growthData);  // Generate the chart
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            loadChildrenList();  // Populate the child dropdown list
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Growth Dashboard</h1>

        <label for="childSelect">Select a Child:</label>
        <select id="childSelect" onchange="filterGrowthData()">
            <option value="">--Select a Child--</option>
        </select>

        <br><br>

        <div class="chart-container">
            <canvas id="growthChart"></canvas>
        </div>

        <br>
        <button class="button" onclick="window.location.href='dashboard.html'">‚Üê Back to Dashboard</button>
    </div>
</body>
</html>
