<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Growth Trends</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Include Chart.js -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <style>
        .chart-container {
            width: 80%;
            height: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <canvas id="growthChart"></canvas> <!-- Canvas for Chart.js -->
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAYkRSxHjVrV9QYk45EDP5K2uHOoW-0pkk",
            authDomain: "kindercare-cd7da.firebaseapp.com",
            projectId: "kindercare-cd7da",
            storageBucket: "kindercare-cd7da.firebasestorage.app",
            messagingSenderId: "930908122510",
            appId: "1:930908122510:web:40f89ca7a5cf8dc3fb48df"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // Create the Chart
        let growthChart;  // Global variable to store the chart instance

        // Function to create and update the chart
        function createChart(growthData) {
            const ctx = document.getElementById('growthChart').getContext('2d');

            // Extracting data for chart
            const ages = growthData.map(data => data.age);
            const heights = growthData.map(data => data.height);
            const weights = growthData.map(data => data.weight);

            // Check if the chart already exists, and destroy it before creating a new one
            if (growthChart) {
                growthChart.destroy();
            }

            // Create or update the chart
            growthChart = new Chart(ctx, {
                type: 'line',  // Line chart to show growth trends
                data: {
                    labels: ages,  // X-axis: Ages of the child
                    datasets: [{
                        label: 'Height (cm)',  // First dataset for height
                        data: heights,  // Y-axis: Heights
                        borderColor: 'blue',  // Line color
                        fill: false,  // Don't fill the area under the line
                        tension: 0.1
                    },
                    {
                        label: 'Weight (kg)',  // Second dataset for weight
                        data: weights,  // Y-axis: Weights
                        borderColor: 'green',  // Line color
                        fill: false,  // Don't fill the area under the line
                        tension: 0.1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,  // Make sure Y-axis starts from 0
                            title: {
                                display: true,
                                text: 'Value (cm / kg)'  // Label for Y-axis
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Age (Years)'  // Label for X-axis
                            }
                        }
                    }
                }
            });
        }

        // Set up Firestore real-time listener
        function listenForGrowthData() {
            db.collection("growth").orderBy("age").onSnapshot((snapshot) => {
                const growthData = [];

                snapshot.forEach(doc => {
                    growthData.push(doc.data());  // Push document data to array
                });

                // Create or update the chart with the fetched data
                createChart(growthData);
            });
        }

        // Initialize the real-time listener
        listenForGrowthData();
    </script>
</body>
</html>
